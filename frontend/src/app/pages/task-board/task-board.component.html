<div id="task-board" class="board">
  <div
    *ngFor="let stage of stages; let stageIndex = index"
    class="stage"
    [id]="stage.id"
    [style]="{ 'background-color': stage.color + '4B' }">
    <h3>{{ stage.name }}</h3>
    <mat-card
      [id]="task.id"
      (click)="viewTask(task)"
      class="task"
      [style]="{ 'background-color': stage.color + '62' }"
      *ngFor="let task of stage.tasks; let i = index">
      <mat-card-header>
        <mat-card-title class="w-100">
          <mat-chip
            class="priority"
            *ngIf="task.priority"
            color="primary"
            [style]="{
              'background-color': TASK_PRIORITY_COLORS[task.priority]
            }"
            [highlighted]="true">
            {{ task.priority }}
          </mat-chip>
          {{ task.title }}
        </mat-card-title>
      </mat-card-header>
      <mat-divider class="w-100" />
      <mat-card-content class="task-content">
        <div
          *ngIf="task.thumbnail && loadedAttachments[task.thumbnail]"
          class="thumbnail-header">
          <img
            class="w-100"
            alt="Not found"
            [src]="loadedAttachments[task.thumbnail]" />
        </div>
        <div class="d-flex flex-row flex-wrap flex-justify-start card-info">
          <div
            class="d-flex flex-row flex-align-items-start flex-justify-start w-50">
            <mat-icon fontIcon="person" class="icon" />
            <ng-container *ngIf="task.assignee">
              {{ task.assignee.firstName }} {{ task.assignee.lastName }}
            </ng-container>
            <ng-container *ngIf="!task.assignee">No assignee</ng-container>
          </div>
          <div
            class="d-flex flex-row flex-align-items-start flex-justify-end w-50"
            *ngIf="task.deadline">
            <mat-icon fontIcon="event_busy" class="icon" />
            {{ simpleDateFormat(task.deadline) }}
          </div>
        </div>
        <div class="d-flex flex-row flex-wrap flex-justify-start card-info">
          <div
            class="d-flex flex-row flex-align-items-start flex-justify-start w-100"
            *ngIf="task.attachments?.length">
            <mat-icon fontIcon="attach_file" class="icon" />
            {{ task.attachments.length }} attachment{{
              task.attachments.length > 1 ? 's' : ''
            }}
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>

<button
  class="new-task"
  matTooltip="New task"
  mat-fab
  color="primary"
  (click)="newTask()">
  <mat-icon fontIcon="add" />
</button>
